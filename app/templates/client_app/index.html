{% extends 'client_app/_base.html' %}
{% load static %}
{% block content %}
<div class="pt-8 mh-screen">
    <div class="w-full ah-screen md:h-screen"
        style=" background-size: cover; background-position: top center; background-image: url('/static/img/backe.jpg'); ">
        <div class="py-4 flex justify-center px-2 text-lg  text-center font-semibold md:text-3xl ">
            <div class="flex items-center justify-center">
                <div class="mr-3">
                    <img class="w-16 shadow rounded-lg" src="/static/logo_client.png" />
                </div>
                <div v-show="!show_thank" class="px-2 py-2 bg-gray-100 font-medium "
                    style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px; border-top-right-radius: 15px;">
                    Que prévoyez-vous acheter ?
                </div>
                <transition name="down">
                    <div v-show="show_thank" class="px-1 py-1 text-sm bg-green-100 text-green-600 font-normal"
                        style="border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; border-top-right-radius: 10px;">
                        Bien reçu! Je vous enverrai très vite les meilleurs vendeurs.
                    </div>
                </transition>
            </div>
            <!---Dites-nous ce que vous prévoyez acheter et nous vous enverrons les meilleurs vendeurs--->
        </div>
        <div class="flex flex-col items-center justify-center px-6 py-6 md:py-0 mx-auto md:h-screen lg:py-0">
            <div
                class="w-full bg-white rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
                <div v-if="false"
                    class="flex p-4 text-sm text-green-700 bg-green-100 rounded-lg dark:bg-green-200 dark:text-green-800"
                    role="alert">
                    <span class="material-icons " style="position: relative; bottom: 0.2rem; right: 0.1rem;">
                        checklist
                    </span>
                    <span class="sr-only">Info</span>
                    <div>
                        <span class="font-medium">Votre demande a bien été pris en compte</span>
                    </div>
                </div>
                <div class="pb-6 px-6 space-y-4 md:space-y-6 sm:p-8">
                    <form class="space-y-4 md:space-y-6" {% if True %} @submit.prevent="activeMod()" {% else %}
                        action="" method="POST" {% endif %}>
                        {% csrf_token %}
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Sélectionnez
                                les
                                produits que vous désirez</label>
                            <div style="cursor: pointer;" @click="showcatMod()"
                                class=" hover:text-rose-500 flex items-center justify-between bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg active:ring-blue-500 active:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:active:ring-blue-500 dark:active:border-blue-500">
                                <span class="block"> ${subs.length} produit<span v-if="subs.length > 0">s</span>
                                    choisi<span v-if="subs.length > 0">s</span> </span>
                                <div>
                                    <span style="position: relative; top: 0.1rem;" class="material-icons">
                                        expand_circle_down
                                    </span>
                                </div>
                            </div>

                        </div>
                        <!---
                        <div>
                            <label for="small"
                                class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Etat du produit</label>
                            <select id="sstate" v-model="state" required name="state"
                                class="block p-2 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-rose-500 focus:border-rose-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-rose-500">

                                <option value="Neuf">Neuf</option>
                                <option value="Occasion">Occasion</option>
                                <option value="Reconditionné">Reconditionné</option>
                            </select>
                        </div>
                        -->
                        <div class="hidden">
                            <div>
                                <label for="bdg_h"
                                    class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Budget maximal
                                    prévu (FCFA)</label>
                                <input type="number" name="bdg_h" id="bdg_h" v-model="bdg_h"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
                                    placeholder="Somme que vous prévoyez utiliser">
                            </div>
                        </div>
                        <div>
                            <label for="small"
                                class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Choisissez
                                l'urgence du besoin</label>
                            <select id="small" v-model="emer" required name="emer"
                                class="block p-2 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-rose-500 focus:border-rose-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-rose-500">

                                <option value="Pas urgent">Pas urgent</option>
                                <option value="Peu urgent">Peu urgent</option>
                                <option value="Urgent">Urgent</option>
                            </select>
                        </div>

                        <div v-if="subs.length">
                            <div v-for="s in subs" :key="s"
                                class="inline-block px-2 py-1 mr-1 my-1 text-sm bg-rose-100 text-rose-600 rounded">
                                ${s}
                            </div>
                        </div>
                        <div v-if="!sending && !show_thank">
                            <button type="submit"
                                class="w-full text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800">Envoyer</button>
                        </div>
                        <div v-else-if="sending && !show_thank">
                            <button type="button"
                                class="py-2.5 px-5 mr-2 mb-2 w-full text-center text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-rose-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">
                                <div class="flex justify-around items-center">
                                    <div>
                                        <span>
                                            <div role="status">
                                                <svg class="inline mr-2 w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-pink-600"
                                                    viewBox="0 0 100 101" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                                                        fill="currentColor" />
                                                    <path
                                                        d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                                                        fill="currentFill" />
                                                </svg>
                                                <span class="sr-only">Loading...</span>
                                            </div>
                                        </span>
                                    </div>
                                </div>
                            </button>
                        </div>
                        <div v-else>
                            <div
                                class="flex space-x-2 items-center text-white bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
                                <div>
                                    <span class="material-icons">
                                        check_circle
                                    </span>
                                </div>
                                <div class="font-medium">
                                    Demande Enregistrée
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <transition name="down">
            <div v-show="down" class="py-2">
                <div v-show="demands.length" class="overflow-x-auto relative">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-900 uppercase dark:text-gray-400">
                            <tr>
                                <th scope="col" class="py-3 px-6">
                                    Produit
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    il y a
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    Menu
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="dem in demands" :key="dem.id" class=" dark:bg-gray-800"
                                :class="{ 'bg-white' : dem.get_duration != '0 min', 'bg-rose-50' : dem.get_duration == '0 min' }">
                                <th scope="row"
                                    class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                    ${dem.subs}
                                </th>
                                <td class="py-4 px-6">
                                    ${dem.get_duration}
                                </td>
                                <td v-if="dem.id != cur_id" class="py-4 px-6  space-x-2">
                                    <button type="button" @click="more_id = dem.id, showmenu()"
                                        class="text-gray-900 d-block pb-1 px-2 pt-2 rounded-lg hover:bg-gray-100 hover:text-rose-800 ">
                                        <span class="material-icons">
                                            more_vert
                                        </span>
                                    </button>
                                </td>
                                <td v-else class="py-4 px-6 flex justify-around space-x-2">
                                    <div>
                                        <div role="status">
                                            <svg class="inline mr-2 w-7 h-7 text-gray-200 animate-spin dark:text-gray-600 fill-rose-600"
                                                viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                                                    fill="currentColor" />
                                                <path
                                                    d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                                                    fill="currentFill" />
                                            </svg>
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                    <div v-if="can_load" @click="dem_p++ ,get_demandes()" class="py-2 flex justify-around">
                        <div>
                            <!-- Previous Button -->
                            <a
                                class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                <div v-if="dem_load" class="">
                                    <div role="status">
                                        <svg class="inline mr-2 w-5 h-5 text-gray-200 animate-spin dark:text-gray-600 fill-rose-600"
                                            viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                                                fill="currentColor" />
                                            <path
                                                d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                                                fill="currentFill" />
                                        </svg>
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                                <div> Suivant </div>
                            </a>

                        </div>
                    </div>
                </div>
                <div v-show="!demands.length">
                    <div class="py-12 px-12 flex justify-around">
                        <img src="/static/img/empty.svg" />
                    </div>
                    <div class="p-6 text-sm font-medium text-center">
                        Aucune demande enregistrée pour le moment.
                    </div>
                </div>
            </div>
        </transition>

        <div class="py-3 flex justify-around ">
            <button type="button" @click="down = !down"
                class=" relative py-2.5 px-5 mr-2 mb-2  text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-rose-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">
                <div class="flex items-center">
                    <div class="mr-2">
                        <span class="material-icons" v-if="!down">
                            expand_more
                        </span><span v-else class="material-icons">
                            expand_less
                        </span>
                    </div>
                    <div>
                        <span> <span v-html="!down ? 'Voir' : 'Cacher'"></span> mes dernières demandes</span>

                    </div>
                </div>
            </button>
        </div>
        <div {% if not ready %} style="display: none;" {% endif %} class="py-2 flex justify-around ">
            <a href="/blog" type="button"
                class="block relative py-2.5 px-5 mr-2 mb-2  text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-yellow-400 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">
                <div class="flex items-center">
                    <div class="mr-2">
                        <img src="/static/blog/logo.png" class="w-8" />
                    </div>
                    <div>
                        <span>Voir le blog de Zawadi</span>

                    </div>

                </div>

            </a>
        </div>
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Pourquoi <span class="font-semibold">Zawadi</span> ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Parce que nous pensons que votre temps est précieux et donc vous n'avez pas à rechercher des produits,
                ils doivent venir vers vous.
            </div>
        </div>
        <div class="py-4 px-5">
            <div class="text-2xl ">
                A quoi sert <span class="font-semibold">Zawadi</span> ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Zawadi a été conçu pour réduire totalement les tracas de recherche de produits. Grâce à Zawadi, vous
                pouvez faire vos achats comme un roi car il vous envoie les meilleurs vendeurs vous présenter leurs
                produits et vous n'avez plus qu'à prendre votre temps pour faire un choix que vous aimerez.
            </div>
        </div>

        <div class="py-4 px-5">
            <div class="text-2xl ">
                Comment <span class="font-semibold">acheter</span> alors grâce à Zawadi ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                C'est simple. Lorsque vous prévoyez un produit qu'il soit urgent ou pas, vous n'avez qu'à remplir
                le petit formulaire en haut et enregistrer la requête d'achat. Très vite les
                meilleurs vendeurs avec les meilleurs prix de votre localité vont vous contacter par Whatsapp ou par
                appel, Email si vous ne disposez pas d'un compte whatsapp, pour vous
                présenter des produits de qualité. Vous pouvez faire votre choix parmi les produits des vendeurs et
                discuter avec ce dernier sur le prix et la récupération.
            </div>
        </div>
        <!---
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Comment Zawadi trouve-t-il des <span class="font-semibold">vendeurs</span> pour ma demande ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Imaginez un roi qui dit à ses serviteurs qu'il aurait besoin de certains produits. Et donc pour répondre
                aux besoins de leur roi, les serviteurs fouillent toutes les régions et selectionnent parmi les
                marchands disposant des produits demandés par le roi ceux qui sont les plus proches, qui sont connus
                pour la qualité de leurs produits et qui ont une bonne relation avec leur client. Ils envoient ensuite
                ces marchands présentés leurs produits au roi afin qu'il puisssent aisement faire son choix parmi les
                meilleurs produits. Ici vous représentez le roi et les serviteurs représentent Zawadi.
            </div>
        </div>
        -->
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Devons-nous faire <span class="font-semibold">confiance</span> aux vendeurs envoyés par Zawadi ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Oui absolement car Zawadi vous envoie uniquement des vendeurs sérieux disposant de garantie. Cette
                garantie nous permet de vous rembourser automatiquement en cas d'imprévus.
            </div>
        </div>
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Puis-je enregistrer des demandes <span class="font-semibold">d'autres personnes</span> ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Oui, vous pouvez enregistrer les demandes d'autres personnes que vous. Cependant assurez-vous
                de rediriger le vendeur vers la personne
                concernée.
            </div>
        </div>
        <div class="py-4 px-5">
            <div class="text-xl ">
                Dois-je nécéssairement avoir la <span class="font-semibold"> totalité de l'argent</span> du produit
                avant d'enregistrer une demande ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                Non, les vendeurs envoyés par Zawadi comprennent que le besoin de l'achat peut ne pas être urgent et
                donc que
                vous ne disposez pas forcément de la totalité de l'argent. Vous constituez alors juste un acheteur
                potentiel pour eux.
            </div>
        </div>
        <!---
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Comment gagner la <span class="font-semibold">récompense du jour</span> ?
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">
            </div>
            <div class="py-3 text-sm">
                Chaque jour Zawadi accorde au meilleur acheteur du jour une récompense qui peut aller jusqu'à <span
                    class="text-rose-500">50.000 XOF</span>. Le meilleur acheteur du jour est choisi en fonction du
                nombre de requête d'achat enregistrées et de l'appréciation des vendeurs. Donc pour gagner la récompense
                chaque jour il faut recevoir une bonne appréciation des vendeurs envoyés par Zawadi ou enregistrer le
                maximum de requête dans la journée.
            </div>
        </div>
        --->
        {% if feeds.count %}
        <div class="py-4 px-5">
            <div class="text-2xl ">
                Avis et Témoignages.
            </div>
            <div class="my-1 w-8 h-1 rounded-full bg-rose-600">

            </div>
            <div class="py-3 text-sm">
                {% if feeds.count %}
                <div class="grid lg:grid-cols-4 md:grid-cols-3 space-y-5 ">
                    {% for feed in feeds %}
                    <div class="pb-2">
                        <div class="flex items-center  ">
                            <div class="pr-2 ">
                                <div :style="{
                        width: '3.5rem',
                        height: '3.5rem',
                        'border-radius': '100%',
                        'background-size': 'cover',
                        'background-position': 'top center',
                        'background-image': `url('{{feed.get_picture}}')`,
                        
                                }"></div>
                            </div>
                            <div>
                                <div class="font-semibold ">
                                    {{feed.user}}
                                </div>
                            </div>
                        </div>
                        <div class="pt-1 text-sm">
                            {{feed.text|safe}}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        <div class="w-full bg-gray-100 text-center pt-4 pb-16">
            Copyright &copy; 2022 <br>
            All Right Reserved <a class="text-rose-500" href="#">Elife Global</a>
        </div>
    </div>
</div>


<!-- Modal toggle -->
<button style="display: none;" id="moreButVend"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="vend-modal">
    Toggle modal
</button>

<!-- Main modal -->
<div id="vend-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button" @click="showmenu"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="vend-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-lg font-medium text-gray-900 dark:text-white">Paramètres de la demande</h3>
                <div class="">

                    <dl class="max-w-md text-gray-900 divide-y divide-gray-200 dark:text-white dark:divide-gray-700">
                        <div class="flex flex-col pb-3">
                            <dt class="mb-1 text-gray-500 md:text-lg dark:text-gray-400">Nombre de vendeurs à envoyer
                            </dt>
                            <dd class="text-lg font-semibold">
                                <div v-if="!param_load">

                                    <select id="num_vend" v-model="num_vend"
                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">

                                        <option value="3">3</option>
                                        <option value="5">5</option>
                                        <option value="7">7</option>
                                        <option value="10">10</option>
                                        <option value="15">15</option>
                                    </select>
                                </div>
                                <div v-else class="py-3">
                                    <div class="text-center">
                                        <div role="status">
                                            <svg class="inline mr-2 w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-blue-600"
                                                viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                                                    fill="currentColor" />
                                                <path
                                                    d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                                                    fill="currentFill" />
                                            </svg>
                                            <span class="sr-only">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                            </dd>
                        </div>

                    </dl>

                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal Dem toggle -->
<button style="display: none;" id="moreButDem"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="moreDem-modal">
    Toggle modal
</button>

<!-- Main Dem modal -->
<div id="moreDem-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="moreDem-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-lg  text-gray-900 dark:text-white">Précision sur ma demande de
                    <span class="font-medium">${get_dem.subs}</span>
                </h3>
                <div class="py-4 ">
                    <div class="flex items-center justify-between">
                        <div class="pb-3"
                            v-if="!(get_dem.budget || get_dem.num || get_dem.detail || get_dem.get_files.length)">
                            <div class="p-4 text-sm text-gray-700 bg-gray-100 rounded-lg dark:bg-gray-700 dark:text-gray-300"
                                role="alert">
                                Vous n'avez pas ajouté de précisions sur ce produit.
                            </div>
                        </div>
                        <div v-else>
                            <ul class="space-y-1 max-w-md list-disc list-inside text-gray-500 dark:text-gray-400">
                                <li v-if="get_dem.budget">
                                    Vous avez prévu un budget de <span class="font-medium">${get_dem.budget} F</span>
                                    pour
                                    ce produit.
                                </li>
                                <li v-if="get_dem.num > 1">
                                    Vous désirez acheter ${get_dem.num} unité de ce produit.
                                </li>
                                <li v-if="get_dem.detail">
                                    Vous avez ajouté une description sur le produit : <span
                                        v-html="get_dem.detail"></span>
                                </li>
                                <li v-if="get_dem.get_files.length">
                                    Vous avez fourni ${get_dem.get_files.length} fichier<span
                                        v-if="get_dem.get_files.length > 1">s</span> pour plus de précision sur ce que
                                    vous désirez.
                                    <ol class="pl-5 mt-2 space-y-1 list-decimal list-inside">
                                        <li v-for="file in get_dem.get_files" :key="file"><a
                                                class="text-blue-500 underline" :href="file">Voir le
                                                fichier N° ${get_index(file, get_dem.get_files) + 1}</a></li>
                                    </ol>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Main AllList -->
<div id="all_list" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-modal md:h-full justify-center items-center">
    <div class="relative p-4 w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="all_list">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Récentes demandes</h3>
                {% if not count %}
                <div class="py-12 flex justify-around">
                    <img src="/static/img/empty.svg" />
                </div>
                <div class="p-6 text-sm font-medium text-center">
                    Aucune demande enregistrée pour le moment.
                </div>
                {% else %}

                <div class="overflow-x-auto relative shadow-md sm:rounded-lg py-4">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                            <tr>
                                <th scope="col" class="py-3 px-6">
                                    Produits demandés
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    <div class="flex items-center">

                                    </div>
                                </th>

                            </tr>
                        </thead>
                        <tbody>
                            {% for d in dems %}
                            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                <th scope="row"
                                    class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                    {{d.subs.name}}
                                </th>
                                <td class="py-4 px-6">
                                    {{d.get_duration}}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% endif %}

            </div>
        </div>
    </div>
</div>


<!-- Modal toggle -->
<button style="display: none;" id="menubtu"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="menu-modal">
    Toggle modal
</button>

<!-- Main modal -->
<div id="menu-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="menu-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Menu de ma demande</h3>
                <div>

                    <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                        <li @click="showmenu(), show_det()" class="py-3 sm:pb-4 hover:bg-gray-100 ">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <span style="position: relative; top: 0.2rem;" class="material-icons text-rose-600">
                                        add_circle
                                    </span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class=" font-medium text-gray-900 truncate dark:text-white">
                                        Voir les détails
                                    </p>
                                </div>
                            </div>
                        </li>
                        <li @click="showmenu(), cur_id = more_id, update_dem('sold')"
                            class="py-3 sm:pb-4 hover:bg-gray-100 ">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <span style="position: relative; top: 0.2rem;"
                                        class="material-icons text-green-600">
                                        check_circle
                                    </span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class=" font-medium text-gray-900 truncate dark:text-white">
                                        Marquer comme "acheté"
                                    </p>
                                </div>
                            </div>
                        </li>
                        <li @click="showmenu(), show_params()" class="py-3 sm:pb-4 hover:bg-gray-100 ">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <span style="position: relative; top: 0.2rem;"
                                        class="material-icons text-green-600">
                                        settings
                                    </span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class=" font-medium text-gray-900 truncate dark:text-white">
                                        Plus de vendeurs
                                    </p>
                                </div>
                            </div>
                        </li>
                        <li @click="showmenu(), cur_id = more_id, update_dem('delete')"
                            class="py-3 sm:pb-4 hover:bg-gray-100 ">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <span style="position: relative; top: 0.2rem;" class="material-icons text-red-600">
                                        delete
                                    </span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class=" font-medium text-gray-900 truncate dark:text-white">
                                        Supprimer la demande
                                    </p>
                                </div>
                            </div>
                        </li>
                    </ul>

                </div>

            </div>
        </div>
    </div>
</div>


<!-- Cat Modal toggle -->
<button id="myCatMod" style="display: none;"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="myCatMod-modal">
    Toggle modal
</button>

<!-- Cat Main modal -->
<div id="myCatMod-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button" id="catclose"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="myCatMod-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="pt-3 pb-5 px-6 lg:px-8">
                <h3 class="mb-2 text-xl font-medium text-gray-900 dark:text-white">Choisisssez la Catégorie</h3>
                <div class="py-2  ">
                    <div>


                        <form class="flex items-center">
                            <label for="simple-search" class="sr-only">Search</label>
                            <div class="relative w-full">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                                        fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <input type="text" id="searchcat" @input="e => cat_search = e.target.value"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-blue-500"
                                    placeholder="Search" required>
                            </div>

                        </form>

                    </div>
                </div>
                <div class="py-3" style="max-height: 66vh; overflow-y: scroll;">
                    <form>
                        <div class="space-y-3" v-if="cat_search == ''">
                            <div v-for="label in all_cats" :key="label.id">
                                <div class="text-lg font-medium pb-3">
                                    ${label.name}
                                </div>
                                <div class="">
                                    <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                                        <li v-for="c in label.cats" :key="c.id"
                                            class="py-3 px-3 sm:pb-4  hover:bg-gray-50">
                                            <div class="flex items-center  space-x-4">
                                                <div class="flex-shrink-0">
                                                    <input :id="`cat${c.id}`" type="radio" :value="c.id"
                                                        @click="from_cat_to_sub(c.id)" name="cat_radio" v-model="cat"
                                                        class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                                                </div>
                                                <div class="flex-1 min-w-0">

                                                    <label :for="`cat${c.id}`">
                                                        <p class=" truncate font-medium text-gray-900 dark:text-white">
                                                            ${c.name}
                                                        </p>
                                                    </label>
                                                </div>
                                                <div :class="{'text-rose-600' : c.id == cat }" class="flex-shrink-0">
                                                    <span class="material-icons">
                                                        arrow_circle_right
                                                    </span>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div v-else>
                            <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                                <li v-for="c in cat_results" :key="c.id" class="py-2 px-3 sm:pb-4  hover:bg-gray-50">
                                    <div class="flex items-center  space-x-4">

                                        <div class="flex-shrink-0">
                                            <input :id="`cat${c.id}`" type="radio" :value="c.id" name="cat_radio"
                                                v-model="cat"
                                                class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                                        </div>
                                        <div class="flex-1 min-w-0">

                                            <label :for="`cat${c.id}`">
                                                <p class=" font-medium text-gray-900 truncate dark:text-white">
                                                    ${c.high}
                                                </p>
                                            </label>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="material-icons">
                                                arrow_circle_right
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </form>

                </div>
            </div>

            <div class="px-6 py-4" v-if="false">
                <button v-if="cat != ''" type="button" @click="go_to_sub()"
                    class="text-white bg-gradient-to-r from-rose-400 via-rose-500 to-rose-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Valider</button>
                <button v-else type="button"
                    class="text-white text-gray-400 bg-gray-100 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Valider</button>
            </div>
        </div>
    </div>
</div>


<!-- Sub Modal toggle -->
<button id="mySubMod" style="display: none;"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="mySubMod-modal">
    Toggle modal
</button>

<!-- Sub Main modal -->
<div v-show="!cur_sub" id="mySubMod-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button @click="r_subs = []" type="button" id="subclose"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="mySubMod-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-3 px-6 lg:px-8">
                <h3 class="mb-2 text-xl font-medium text-gray-900 dark:text-white">Sélectionnez ce que vous voulez</h3>
                <div class="py-2  ">
                    <div>
                        <form class="flex items-center">
                            <label for="simple-search" class="sr-only">Search</label>
                            <button @click="backtocat()" type="button"
                                class=" mr-2 text-rose-700 border border-rose-700 hover:bg-rose-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center dark:border-rose-500 dark:text-rose-500 dark:hover:text-white dark:focus:ring-rose-800">
                                <span class="material-icons">
                                    arrow_back
                                </span>
                            </button>
                            <div class="relative w-full">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                                        fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <input type="text" id="searchsub" @input="e => sub_search = e.target.value"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                    placeholder="Search" required>
                            </div>

                        </form>

                    </div>
                </div>
                <div v-if="sub_search == ''" class="py-3" style="max-height: 56vh; overflow-y: scroll;">
                    <form>
                        <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                            <li class="py-3 px-3 sm:pb-4" v-for="sb in all_subs" :key="sb.id">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0">
                                        <input :value="sb.id" name="sub_radio" :checked="includes_subs(sb.id)"
                                            :id="`sub${sb.id}`" type="radio"
                                            @click="cur_ssub = sb.id, from_sub_to_ssub(sb)"
                                            class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                                    </div>
                                    <div class="flex-1 min-w-0 hover:bg-gray-50 ">
                                        <label :for="`sub${sb.id}`">
                                            <p class="font-medium text-gray-900  dark:text-white">
                                                ${sb.name}
                                            </p>
                                            <div v-if="has_sub_det(sb.id)">
                                                <p v-if="has_sub_det(sb.id).bdg"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Budget prévu : ${has_sub_det(sb.id).bdg} F
                                                </p>
                                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Nombre voulu : ${has_sub_det(sb.id).num_prod}
                                                </p>
                                                <p v-if="has_sub_det(sb.id).detail"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Détail : ${has_sub_det(sb.id).detail}
                                                </p>
                                                <p v-if="has_sub_det(sb.id).files"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    ${has_sub_det(sb.id).files.length} fichier<span
                                                        v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                                    ajouté<span
                                                        v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                    <div v-if="sb.get_subs.length == 1" style="cursor: pointer;"
                                        @click="cur_sub = sb.id, setPrev()"
                                        class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white hover:bg-gray-100 hover:p-2 hover:rounded-lg hover:text-rose-500">
                                        <span class="material-icons">
                                            add_circle
                                        </span>
                                    </div>
                                    <div v-else :class="{'text-rose-600' : sb.id == cur_ssub }" class="flex-shrink-0">
                                        <span class="material-icons">
                                            arrow_circle_right
                                        </span>
                                    </div>
                                </div>
                            </li>
                        </ul>

                    </form>

                </div>
                <div v-else class="py-3" style="max-height: 60vh; overflow-y: scroll;">
                    <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                        <li class="py-3 px-3 sm:pb-4" v-for="sb in sub_results" :key="sb.id">
                            <div class="flex items-center space-x-4">
                                <div class="flex-shrink-0">
                                    <input :value="sb.id" name="sub_radio" v-model="cur_ssub" :id="`sub${sb.id}`"
                                        type="radio" @click="from_sub_to_ssub(sb)"
                                        class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                                </div>
                                <div class="flex-1 min-w-0 hover:bg-gray-50 ">
                                    <label :for="`sub${sb.id}`">
                                        <p class="font-medium text-gray-900 truncate dark:text-white">
                                            ${sb.name}
                                        </p>
                                        <div v-if="has_sub_det(sb.id)">
                                            <p v-if="has_sub_det(sb.id).bdg"
                                                class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                Budget prévu : ${has_sub_det(sb.id).bdg} F
                                            </p>
                                            <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                Nombre voulu : ${has_sub_det(sb.id).num_prod}
                                            </p>
                                            <p v-if="has_sub_det(sb.id).detail"
                                                class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                Détail : ${has_sub_det(sb.id).detail}
                                            </p>
                                            <p v-if="has_sub_det(sb.id).files"
                                                class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                ${has_sub_det(sb.id).files.length} fichier<span
                                                    v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                                ajouté<span
                                                    v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                            </p>
                                        </div>
                                    </label>
                                </div>
                                <div v-if="sb.get_subs.length > 1" style="cursor: pointer;"
                                    @click="cur_sub = sb.id, setPrev()"
                                    class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white hover:bg-gray-100 hover:p-2 hover:rounded-lg hover:text-rose-500">
                                    <span class="material-icons">
                                        add_circle
                                    </span>
                                </div>
                                <div v-else :class="{'text-rose-600' : c.id == cur_ssub }" class="flex-shrink-0">
                                    <span class="material-icons">
                                        arrow_circle_right
                                    </span>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="px-6 py-4">
                <button v-if="r_subs.length" @click="showsubMod()" type="button"
                    class="text-white bg-gradient-to-r from-rose-400 via-rose-500 to-rose-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Enregistrer</button>
                <button v-else type="button"
                    class="text-white text-gray-400 bg-gray-100 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Enregistrer</button>
            </div>
        </div>
    </div>
</div>

<!-- SubSub Modal toggle -->
<button id="mySubSubMod" style="display: none;"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="mySubSubMod-modal">
    Toggle modal
</button>

<!-- SubSub Main modal -->
<div v-show="!cur_sub" id="mySubSubMod-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button @click="r_subs = []" type="button" id="subclose"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="mySubSubMod-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-3 px-6 lg:px-8">
                <h3 class="mb-2 text-xl font-medium text-gray-900 dark:text-white">Sélectionnez les produits que vous
                    désirez</h3>
                <div class="py-2  ">
                    <div>
                        <form class="flex items-center">
                            <label for="simple-search" class="sr-only">Search</label>
                            <button @click="r_subs = [], showsubsubMod()" type="button"
                                class=" mr-2 text-rose-700 border border-rose-700 hover:bg-rose-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-full text-sm p-2.5 text-center inline-flex items-center dark:border-rose-500 dark:text-rose-500 dark:hover:text-white dark:focus:ring-rose-800">
                                <span class="material-icons">
                                    arrow_back
                                </span>
                            </button>
                            <div v-if="false" class="relative w-full">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                                        fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <input type="text" id="searchsub" @input="e => ssub_search = e.target.value"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                    placeholder="Search" required>
                            </div>

                        </form>

                    </div>
                </div>
                <div class="py-3" style="max-height: 56vh; overflow-y: scroll;">
                    <form>
                        <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                            <li class="py-3 px-3 sm:pb-4" v-for="sb in all_subssubs" :key="sb.id">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0">
                                        <input :value="sb.id" name="sub_radio" :checked="includes_subs(sb.id)"
                                            :id="`sub${sb.id}`" type="checkbox" @click="add_us(sb)"
                                            class="w-4 h-4 text-rose-600 bg-gray-100 rounded border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                    </div>
                                    <div class="flex-1 min-w-0 hover:bg-gray-50 ">
                                        <label :for="`sub${sb.id}`">
                                            <p class="font-medium text-gray-900  dark:text-white">
                                                ${sb.name}
                                            </p>
                                            <div v-if="has_sub_det(sb.id)">
                                                <p v-if="has_sub_det(sb.id).bdg"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Budget prévu : ${has_sub_det(sb.id).bdg} F
                                                </p>
                                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Nombre voulu : ${has_sub_det(sb.id).num_prod}
                                                </p>
                                                <p v-if="has_sub_det(sb.id).detail"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    Détail : ${has_sub_det(sb.id).detail}
                                                </p>
                                                <p v-if="has_sub_det(sb.id).files"
                                                    class="text-sm text-gray-500 truncate dark:text-gray-400">
                                                    ${has_sub_det(sb.id).files.length} fichier<span
                                                        v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                                    ajouté<span
                                                        v-html="has_sub_det(sb.id).files.length > 1 ? 's' : '' "></span>
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                    <div style="cursor: pointer;" @click="cur_sub = sb.id, setPrev()"
                                        class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white hover:bg-gray-100 hover:p-2 hover:rounded-lg hover:text-rose-500"
                                        :class="{ 'p-2 bg-rose-600 text-white rounded-lg shadow-xl': includes_subs(sb.id) }">
                                        <span class="material-icons">
                                            add_circle
                                        </span>
                                    </div>
                                </div>
                            </li>
                        </ul>

                    </form>

                </div>
            </div>

            <div class="px-6 py-4">
                <button v-if="r_subs.length" @click="showsubsubMod(false)" type="button"
                    class="text-white bg-gradient-to-r from-rose-400 via-rose-500 to-rose-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Enregistrer</button>
                <button v-else type="button"
                    class="text-white text-gray-400 bg-gray-100 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Enregistrer</button>
            </div>
        </div>
    </div>
</div>


<!-- More modal -->
<div id="more-modal" v-if="cur_sub" tabindex="-1"
    class=" overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- More Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button @click="cur_sub = 0" type="button"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="more-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">Plus de précisions aux vendeurs</h3>
                <form class="space-y-3" action="#">
                    <div>
                        <label for="bdg" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Budget
                            prévu</label>
                        <input type="number" name="bdg" id="bdg" v-model="bdg"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
                            placeholder="Somme que vous prévoyez utiliser" required>
                    </div>
                    <div>
                        <label for="num_prod"
                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nombre désiré</label>
                        <input type="number" name="num_prod" id="num_prod" v-model="num_prod"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white"
                            placeholder="Nombre de produit désiré" required>
                    </div>
                    <div>
                        <label for="message"
                            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Ajoutez des détails
                        </label>
                        <textarea id="message" rows="4" v-model="detail"
                            class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-rose-500 focus:border-rose-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-rose-500"
                            placeholder="donnez plus de détails( marque, taille, performance...)"></textarea>
                    </div>
                    <div>

                        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
                            for="multiple_files">Des Images pour plus de précision</label>
                        <input @change="setFiles"
                            class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400"
                            id="multiple_files" type="file" multiple>

                    </div>
                    <button type="submit" @click="build_sub_det()"
                        class="w-full text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800">Enregistrer</button>

                </form>
            </div>
        </div>
    </div>
</div>

<button id="quartMod" style="display: none;"
    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
    type="button" data-modal-toggle="quartMod-modal">
    Toggle modal
</button>

<!-- Quart Main modal -->
<div id="quartMod-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 p-4 w-full md:inset-0 h-modal md:h-full">
    <div class="relative w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button" id="quartclose" @click="activeMod()"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="quartMod-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-3 px-6 lg:px-8">
                <h3 class="mb-2 mr-3 text-xl font-medium text-gray-900 dark:text-white">Entrez le nom de votre
                    quartier ou d'un lieu connu proche de chez vous</h3>
                <div class="py-2  ">
                    <div>


                        <form class="flex items-center">
                            <label for="simple-search" class="sr-only">entrez...</label>
                            <div class="relative w-full">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400"
                                        fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <input type="text" id="searchcat" @input="e => quarti = e.target.value"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                    placeholder="entrez..." required>
                            </div>

                        </form>

                    </div>
                </div>
                <div class="py-3" style="max-height: 60vh; overflow-y: scroll;">
                    <div v-if="quart.name == '' && !quarts.length && quarti == ''">
                        <div class="p-4 flex justify-around">
                            <img class="w-full" src="{% static 'img/city.svg' %}" />
                        </div>
                        <div class="text-center">
                            Veuillez entrer le nom de votre quartier et choisissez le resultat le plus proche de chez
                            vous
                        </div>
                    </div>
                    <div v-if="quarts.length">

                        <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                            <li class="p-3 sm:pb-4 hover:bg-gray-100" v-for="quar in quarts" :key="slugify(quar)">
                                <div class="flex items-center space-x-4">
                                    <div class="flex-shrink-0">
                                        <i class="material-icons">place</i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <label :for="slugify(quar)">
                                            <p class=" font-medium text-gray-900 dark:text-white">
                                                ${quar.name}
                                            </p>
                                        </label>
                                    </div>
                                    <div
                                        class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                                        <input
                                            :checked="quart.name == quar.name && quart.lat == quar.lat && quart.lng == quar.lng"
                                            :id="slugify(quar)" type="radio" name="quar_radio" @click="quart = quar"
                                            class="w-4 h-4 text-rose-600 bg-gray-100 border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                                    </div>
                                </div>
                            </li>
                        </ul>

                    </div>
                    <div v-if="!quarts.length && quarti != '' && !isTyping">
                        <div class="p-4 flex justify-around">
                            <img class="w-full" src="{% static 'img/r_city.svg' %}" />
                        </div>
                        <div class="text-center">
                            Nous ne trouvons pas de lieu correspondant
                        </div>
                    </div>
                    <div v-if="!quarts.length && quarti != '' && isTyping">
                        <div class="p-6 flex justify-around">
                            <div role="status">
                                <svg aria-hidden="true"
                                    class="mr-2 w-8 h-8 text-gray-200 animate-spin dark:text-gray-600 fill-rose-600"
                                    viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
                                        fill="currentColor" />
                                    <path
                                        d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
                                        fill="currentFill" />
                                </svg>
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="px-6 py-4">
                <button @click="activeMod(), f_quart = quart, showquartMod(), quarti = ''" v-if="quart.name != ''"
                    type="button"
                    class="text-white bg-gradient-to-r from-rose-400 via-rose-500 to-rose-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Valider</button>
                <button v-else type="button"
                    class="text-white text-gray-400 bg-gray-100 focus:outline-none focus:ring-rose-300 dark:focus:ring-rose-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2 w-full text-center ">Valider</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal User -->
<button style="display: none;" id="myBut"
    class="block text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800"
    type="button" data-modal-toggle="authentication-modal">
    Toggle modal
</button>

<!-- Main User -->
<div id="authentication-modal" tabindex="-1" aria-hidden="true"
    class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 w-full md:inset-0 h-modal md:h-full justify-center items-center">
    <div class="relative p-4 w-full max-w-md h-full md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
            <button type="button" id="closeModUs"
                class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white"
                data-modal-toggle="authentication-modal">
                <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd"></path>
                </svg>
                <span class="sr-only">Close modal</span>
            </button>
            <div class="py-6 px-6 lg:px-8">
                <h3 class="mb-4  font-medium text-gray-900 dark:text-white">Nouveau sur Zawadi! Aidez nos vendeurs à
                    vous contacter </h3>
                <form class="space-y-6" @submit.prevent="send_dem()">
                    <div class="grid grid-cols-2">
                        <div class="mr-2">

                            <input type="text" id="first_name" name="first_name" v-model="first_name"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-rose-500"
                                placeholder="Nom" required>
                        </div>
                        <div>

                            <input type="text" id="last_name" name="last_name" v-model="last_name"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-rose-500 focus:border-rose-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-rose-500 dark:focus:border-rose-500"
                                placeholder="Prénom" required>
                        </div>
                    </div>
                    <div>
                        <input type="email" id="email" name="email" v-model="email"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                            placeholder="Email" required>
                    </div>

                    <div class="relative z-0">
                        <input id="phone" required type="tel" name="phone" v-model="numb"
                            class="block py-3 px-0 mb-2 w-full text-lg text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-purple-500 focus:outline-none focus:ring-0 focus:border-purple-600 peer" />
                    </div>
                    <div v-show="is_what" class="flex items-center">
                        <input id="checked-checkbox"  v-model="is_what" type="checkbox"
                            class="w-4 h-4 text-rose-600 bg-gray-100 rounded border-gray-300 focus:ring-rose-500 dark:focus:ring-rose-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                        <label for="checked-checkbox"
                            class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">C'est le même que mon
                            numéro
                            Whatsapp</label>
                    </div>
                    <div v-show="!is_what">
                        <div class="mb-1">Entrez le numéro whatsapp</div>
                        <div class="relative z-0">
                            <input id="phonewhat" required type="tel" name="phonewhat" v-model="whatsapp"
                                class="block py-3 px-0 mb-2 w-full text-lg text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-purple-500 focus:outline-none focus:ring-0 focus:border-purple-600 peer" />
                        </div>
                    </div>
                    <div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">
                                Entrez le nom de votre
                                quartier ou d'un lieu connu proche de chez vous</label>
                            <div style="cursor: pointer;" @click="showquartMod(), activeMod()"
                                class=" hover:text-rose-500 flex items-center justify-between bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg active:ring-blue-500 active:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:active:ring-blue-500 dark:active:border-blue-500">
                                <span class="block text-gray-500" v-if="f_quart.name == ''">Aucun nom entré</span> <span
                                    class="block" v-else>${f_quart.name}</span>
                                <div>
                                    <span style="position: relative; top: 0.1rem;" class="material-icons">
                                        place
                                    </span>
                                </div>
                            </div>

                        </div>
                        <!---
                        <div class="grid grid-cols-2">
                            <div class="mr-2">
                                <select id="coutries" name="coutry" required v-model="country"
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                    <option value="bj">Benin</option>
                                    <option value="tg">Togo</option>
                                    <option value="ci">Côte D'Ivoire</option>
                                </select>
                            </div>
                            <div>
                                <div v-for="c in countries" :key="c">
                                    <select name="towns[]" v-if="c == country" required multiple id="coutries_multiple"
                                        v-model="town"
                                        class="bg-gray-50 border border-gray-300 t     ext-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                        <option v-for="t in towns[c]" :value="t"> ${t} </option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                    <button type="submit"
                        class="w-full text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:outline-none focus:ring-rose-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-rose-600 dark:hover:bg-rose-700 dark:focus:ring-rose-800">Confirmer</button>

                    <div class="text-sm font-medium text-gray-500 dark:text-gray-300">
                        En validant, vous acceptez de recevoir des messages de la part de Zawadi par whatsapp
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<button id="indicate" type="button" data-modal-target="crypto-modal" data-modal-toggle="crypto-modal"
    class="hidden text-gray-900 bg-white hover:bg-gray-100 border border-gray-200 focus:ring-4 focus:outline-none focus:ring-gray-100 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700">
    <svg aria-hidden="true" class="hidden w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1">
        </path>
    </svg>
    Comment
</button>

<!-- Main modal -->
<div id="crypto-modal" tabindex="-1" aria-hidden="true"
    class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-modal md:h-full">
    <div class="relative w-full h-full max-w-md md:h-auto">
        <!-- Modal content -->
        <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">

            <!-- Modal header -->
            <div class="px-6 py-4 border-b rounded-t dark:border-gray-600">
                <h3 class="text-base font-semibold text-gray-900 lg:text-xl dark:text-white">
                    Le saviez-vous ?
                </h3>
            </div>
            <!-- Modal body -->
            <div class="p-6">
                <p class="font-normal dark:text-gray-400 py-3">Vous pouvez mettre plus de précision sur vos demandes en
                    ajoutant <strong > le budget ou une description</strong> pour mieux guider le vendeur </p>
                <div class="py-4">
                    <img src="/static/indicate.png" class="w-full" />
                </div>
                <div class=" py-4">
                    Pour le faire vous devez juste cliquez le bouton <strong> + (en rouge)</strong> lorsque vous sélectionnez un produit( exemple sur l'image)
                </div>
                <div class="my-3">
                    <button type="button" onclick="indicated()"
                                    class="inline-flex w-full justify-center rounded-md border border-transparent bg-rose-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm">J'ai compris</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="map" style="display: none;">

</div>
<div id="myTo" v-if="false" style="position: absolute; top: 8vh; left: 3vw;">
    <div id="toast-success"
        class="flex items-center p-4 mb-4 w-full max-w-xs text-gray-500 bg-white rounded-lg shadow dark:text-gray-400 dark:bg-gray-800"
        role="alert">
        <div
            class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 text-rose-500 bg-rose-100 rounded-lg dark:bg-rose-800 dark:text-rose-200">
            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"></path>
            </svg>
            <span class="sr-only">Check icon</span>
        </div>
        <div class="ml-3 text-sm font-normal">Votre requetes a été enregistrée avec succes.</div>
        <button type="button"
            class="ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700"
            data-dismiss-target="#toast-success" aria-label="Close">
            <span class="sr-only">Close</span>
            <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                    clip-rule="evenodd"></path>
            </svg>
        </button>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="/static/axios.min.js"></script>
<script src="/static/fuzzysort.js"></script>
<script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNoBJJXRj_p5miy5gSPGazRa4Mr-95D18&libraries=places&callback=initMap">
    </script>
<script>
    {% if ident %}
    localStorage.setItem("ident", "{{ident}}")
    {% endif %}

    const indicated = () => {
        localStorage.setItem('indicate', 'yes')
        document.getElementById('indicate').click()
    }

    const indicate = localStorage.getItem('indicate')
    if (!indicate) {
        setTimeout(() => {
            document.getElementById('indicate').click()
        }, 5000)
    }
</script>
<script>
    var map;
    var service;
    var infowindow;
    function initMap() {
        var sydney = new google.maps.LatLng(-33.867, 151.195);

        infowindow = new google.maps.InfoWindow();

        map = new google.maps.Map(
            document.getElementById('map'), { center: sydney, zoom: 15 });
        var service = new google.maps.places.PlacesService(map);
        window.serviceMaps = service
        //service.findPlaceFromQuery(request, function (results, status) {
        //    if (status === google.maps.places.PlacesServiceStatus.OK) {
        //        for (var i = 0; i < results.length; i++) {
        //            createMarker(results[i]);
        //        }
        //        map.setCenter(results[0].geometry.location);
        //    }
        //});
    }
    let baseUR = window.location.host
    let prot = window.location.protocol
    axios.defaults.baseURL = prot + "//" + baseUR + "/"
    // sleep time expects milliseconds
    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }
    function getIp(callback) {
        fetch('https://ipinfo.io/json?token=d737ce5f6899f5', { headers: { 'Accept': 'application/json' } })
            .then((resp) => resp.json())
            .catch(() => {
                return {
                    country: 'bj',
                };
            })
            .then((resp) => { callback(resp.country) });
    }
    const { createApp } = Vue
    const app = createApp({
        data() {
            let phonein = null
            // Usage!
            sleep(500).then(() => {

                window.phoneInputField = document.getElementById("phone")
                window.phoneInput = window.intlTelInput(phoneInputField, {
                    preferredCountries: ["bj", "tg", "ci"],
                    initialCountry: "auto",
                    geoIpLookup: getIp,
                    utilsScript:
                        "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
                });
                window.phoneInputField_w = document.getElementById("phonewhat")
                window.phoneInput_w = window.intlTelInput(phoneInputField_w, {
                    preferredCountries: ["bj", "tg", "ci"],
                    initialCountry: "auto",
                    geoIpLookup: getIp,
                    utilsScript:
                        "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
                });
            });

            return {
                def_cat: "Cliquez pour choisir",
                user: '{% if not has_user %}not{% endif %}',
                phoneInput: 0,
                is_what: true,
                num: "",
                num_err: [],
                can_show_valid: true,
                country: 'bj',
                numb: "",
                cat: "",
                r_subs: [],
                emer: "Urgent",
                is_registered: false,
                first_name: "",
                last_name: "",
                email: "",
                town: [],
                down: false,
                countries: ['bj', 'tg', 'ci'],
                number: "",
                whatsapp: "",
                sending: false,
                show_thank: false,
                cur_id: 0,
                demands: [],
                towns: {
                    'bj': [
                        'Cotonou',
                        'Porto-Novo',
                        'Parakou',
                        'Abomey',
                        'Djougou',
                        'Bohicon',
                        'Kandi',
                        'Natitingou',
                        'Ouidah',
                        'Lokossa',
                        'Abomey-Calavi'
                    ],
                    'tg': [
                        'Lomé',
                        'Sokodé',
                        'Kara',
                        'Kpalimé',
                        'Atakpamé',
                        'Bassar',
                        'Tsévié',
                        'Aného',
                        'Mango',
                        'Dapaong',
                        'Tchamba',
                        'Niamtougou'
                    ],
                    'ci': [
                        'Abidjan',
                        'Bouaké',
                        'Daloa',
                        'Yamoussoukro',
                        'San-Pédro',
                        'Divo',
                        'Korhogo',
                        'Anyama',
                        'Abengourou',
                        'Man',
                        'Gagnoa',
                        'Soubré',
                        'Agboville',
                        'Dabou',
                        'Grand-Bassam',
                        'Bouaflé',
                        'Issia',
                        'Sinfra',
                        'Katiola'
                    ]
                },
                dem_load: false,
                dem_p: 1,
                can_load: true,
                all_cats: [],
                cur_sub: 0,
                bdg: null,
                bdg_h: null,
                detail: null,
                num_prod: 1,
                files: [],
                sub_det: [],
                target_sub: 0,
                cat_search: "",
                sub_search: "",
                more_id: 0,
                num_vend: "0",
                param_load: false,
                not_real: false,
                quarti: "",
                quart: {
                    name: "",
                    lat: 0,
                    lng: 0
                },
                f_quart: {
                    name: "",
                    lat: 0,
                    lng: 0
                },
                quarts: [],
                isTyping: false,
                cur_ssub: 0,
                state: "Neuf"
            }
        },
        mounted() {
            let th = this
            const end_load = () => {
                document.getElementById('global_load').style.display = 'none'
                document.getElementById('app').style.display = 'block'
            }
            axios({
                url: '/api/get_all_cats/',
                method: 'GET'
            }).then(resp => {
                if (resp.data['done']) {
                    th.all_cats = resp.data['result']
                    end_load();
                }
            }).catch(err => {
                console.log(err);
            })
            setTimeout(() => {
                getIp((country) => { th.country = country })
            }, 500)
            const customers_info = localStorage.getItem('customers_info')
            if (customers_info) {
                let my_info = JSON.parse(customers_info)
                th.first_name = my_info['first_name']
                th.last_name = my_info['last_name']
                th.email = my_info['email']
                th.town = my_info['town']
                th.country = my_info['country']
                th.whatsapp = my_info['whatsapp']
                th.number = my_info['number']
                if (my_info['quart']) th.f_quart = my_info['quart']
                if (th.email) th.is_registered = true
                if(!my_info['whatsapp']){
                    th.user = 'not'
                    th.is_registered = false
                }
            }
            th.get_demandes()
        },
        watch: {
            quarti(newq, oldq) {
                var request = {
                    query: newq,
                    fields: ['name', 'geometry'],
                };
                this.isTyping = true
                this.quarts = []
                this.quart = {
                    name: "",
                    lat: 0,
                    lng: 0
                }
                let th = this
                window.serviceMaps.findPlaceFromQuery(request, function (results, status) {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        for (elt of results) {
                            th.quarts.push({
                                name: elt.name,
                                lat: elt.geometry.location.lat(),
                                lng: elt.geometry.location.lng()
                            })
                        }
                    }
                    th.isTyping = false
                })
            },
            cat(newc, oldc) {
                this.r_subs = []
                this.clean_sub_search()
            },
            num_vend(newn, oldn) {
                let th = this
                if (!th.not_real) this.param_load = true
                if (!th.not_real) axios({
                    url: `api/set_num_vend/?dem=${th.more_id}&num_vend=${newn}`,
                    method: 'GET'
                }).then(resp => {
                    th.param_load = false

                }).catch(err => {
                    console.log(err);
                })
            },
            more_id(newm, oldm) {
                this.not_real = true
                this.num_vend = `${this.get_dem.num_vend}`
                setTimeout(() => { this.not_real = false }, 50)
            }
        },
        computed: {
            get_dem() {
                let dems = {
                    'subs': '',
                    'bdg': null,
                    'detail': null,
                    'num': null,
                    'get_files': []
                }
                for (dem of this.demands) {
                    if (dem.id == this.more_id) {
                        return dem
                    }
                }
                return dems
            },
            cat_results() {
                let l = []
                for (label of this.all_cats) {
                    for (cat of label.cats) {
                        let ct = {}
                        ct['id'] = cat.id
                        const result = this.accentsTidy(cat.name).search(this.accentsTidy(this.cat_search))
                        ct['score'] = result
                        ct['high'] = cat.name
                        for (sub of cat.subs) {
                            const sresult = this.accentsTidy(sub.name).search(this.accentsTidy(this.cat_search))
                            if (sresult >= 0 && result >= 0) {
                                if (sresult < result) ct['score'] = sresult
                            } else if (sresult >= 0 && result < 0) {
                                ct['score'] = sresult
                            }
                        }
                        if (ct['score'] >= 0) l.push(ct)
                    }
                }
                return l.sort((e1, e2) => {
                    return e1['score'] - e2['score']
                })
            },
            sub_results() {
                let l = []

                for (sub of this.all_subs) {
                    let sb = {}
                    sb['id'] = sub.id
                    sb['high'] = sub.name
                    sb['cat'] = cat.name
                    const result = this.accentsTidy(sub.name).search(this.accentsTidy(this.sub_search))
                    sb['score'] = result
                    if (result >= 0) l.push(sb)
                }

                return l.sort((e1, e2) => {
                    return e1['score'] - e2['score']
                })
            },
            subs() {
                let mul = []
                for (sb of this.r_subs) {
                    mul.push(sb.name)
                }
                return mul
            },
            aler() {
                console.log(this.files);
            },
            all_subs() {
                if (this.cat == "") {
                    return []
                }
                for (label of this.all_cats) {
                    for (cat of label.cats) {
                        if (cat.id.toString() == this.cat) {
                            return cat.subs
                        }
                    }
                }
            },
            all_subssubs() {
                for (sub of this.all_subs) {
                    if (sub.id.toString() == this.cur_ssub) {
                        return sub.get_subs
                    }
                }
            }
        },
        methods: {
            from_sub_to_ssub(sub) {

                setTimeout(() => {
                    if (sub.get_subs.length != 1) {
                        this.showsubsubMod()
                    } else {
                        this.add_us(sub)

                    }
                }, 150)
            },
            from_cat_to_sub(id) {
                setTimeout(() => {
                    this.cat = id
                    this.go_to_sub()
                }, 150)
            },
            quart_include(quar) {
                for (q of this.quarts) {
                    if (q.name == quar.name && q.lat == quar.lat && q.lng == quar.lng) {
                        return true
                    }
                }
                return false
            },
            slugify(quart) {
                return `${quart.name}:${quart.lat}:${quart.lng}`
            },
            showquartMod() {
                document.getElementById('quartMod').click()
            },
            show_params() {
                document.getElementById('moreButVend').click()
            },
            get_index(el, lis) {
                for (let i = 0; i < lis.length; i++) {
                    if (lis[i] == el) {
                        return i
                    }
                }
                return -1
            },
            show_det() {
                document.getElementById('moreButDem').click()
            },
            showmenu() {
                document.getElementById('menubtu').click()

            },
            clean_sub_search() {
                this.sub_search = ""
                document.getElementById('searchsub').value = ""
            },
            clean_cat_search() {
                this.cat_search = ""
                document.getElementById('searchcat').value = ""
            },
            accentsTidy: function (s) {
                var r = s.toLowerCase();
                r = r.replace(new RegExp("\\s", 'g'), "");
                r = r.replace(new RegExp("[àáâãäå]", 'g'), "a");
                r = r.replace(new RegExp("æ", 'g'), "ae");
                r = r.replace(new RegExp("ç", 'g'), "c");
                r = r.replace(new RegExp("[èéêë]", 'g'), "e");
                r = r.replace(new RegExp("[ìíîï]", 'g'), "i");
                r = r.replace(new RegExp("ñ", 'g'), "n");
                r = r.replace(new RegExp("[òóôõö]", 'g'), "o");
                r = r.replace(new RegExp("œ", 'g'), "oe");
                r = r.replace(new RegExp("[ùúûü]", 'g'), "u");
                r = r.replace(new RegExp("[ýÿ]", 'g'), "y");
                r = r.replace(new RegExp("\\W", 'g'), "");
                return r;
            },
            closesubMod() {
                document.getElementById('subclose').click()
            },
            backtocat() {
                this.r_subs = []
                document.getElementById('subclose').click()
                this.showcatMod()
            },
            add_us(elt) {
                if (this.includes_subs(elt.id)) {
                    this.r_subs = this.r_subs.filter(e => e['id'] != elt.id)
                } else {
                    this.r_subs.push(elt)
                }
            },
            includes_subs(id) {
                return this.r_subs.filter(e => e['id'] == id).length > 0
            },
            has_sub_det(id) {
                for (el of this.sub_det) {
                    if (el['id'] == id) {
                        return el
                    }
                }
                return 0
            },
            setPrev() {
                for (e of this.sub_det) {
                    if (e['id'] == this.cur_sub) {
                        this.bdg = e.bdg
                        this.num_prod = e.num_prod
                        this.detail = e.detail
                    }
                }
            },
            get_sub(id) {
                for (sub of this.all_subs) {
                    for (sb of sub.get_subs) {
                        if (sb.id == id) return sb
                    }
                    if (sub.id == id) return sub

                }
            },
            build_sub_det() {
                if (!this.cur_sub) {
                    return;
                }
                console.log(this.sub_det.filter(e => e['id'] != this.cur_sub));
                this.sub_det = this.sub_det.filter(e => e['id'] != this.cur_sub)
                let det = { 'id': this.cur_sub }
                if (this.bdg) {
                    det['bdg'] = this.bdg
                }
                if (this.detail) {
                    det['detail'] = this.detail
                }
                if (this.num_prod) {
                    det['num_prod'] = this.num_prod
                }
                if (this.files.length) {
                    det['files'] = this.files
                }
                this.sub_det.push(det)
                if (!this.includes_subs(this.cur_sub)) {
                    this.r_subs.push(this.get_sub(this.cur_sub))
                }
                this.cur_sub = 0
                this.bdg = null
                this.detail = null
                this.num_prod = 1
                this.files = []
                console.log(this.sub_det);
            },
            setFiles(e) {
                this.files = []
                let myFiles = e.target.files
                for (f of myFiles) {
                    this.files.push(f)
                }
            },
            showsubsubMod(is_dir = true) {

                if (is_dir) this.showsubMod();
                document.getElementById('mySubSubMod').click()
            },
            go_to_sub() {
                document.getElementById('catclose').click()
                this.showsubMod()
            },
            showsubMod() {
                document.getElementById('mySubMod').click()
            },
            showcatMod() {
                this.clean_cat_search()
                document.getElementById('myCatMod').click()
            },
            get_demandes() {
                let th = this
                th.dem_load = true
                const form = new FormData()

                form.append('first_name', th.first_name)
                form.append('last_name', th.last_name)
                form.append('email', th.email)
                form.append('country', th.country)
                form.append('town', JSON.stringify(th.town))
                form.append('number', th.number)
                form.append('whatsapp', th.whatsapp)
                axios({
                    url: `api/get_demands/?p=${th.dem_p}`,
                    method: 'POST',
                    headers: {
                        "accept": "application/json",
                    },
                    data: form
                }).then(resp => {
                    th.dem_load = false
                    th.can_load = resp.data['result'].length != 0
                    if (resp.data['done']) {
                        th.demands = th.demands.concat(resp.data['result'])
                    }
                }).catch(err => {
                    console.log(err);
                })
            },
            update_dem(action) {
                let th = this

                axios({
                    url: `api/delete_demand/${th.cur_id}/?action=${action}`,
                    method: 'GET'
                }).then(resp => {
                    if (resp.data['done']) {
                        th.cur_id = 0
                        th.demands = th.demands.filter(e => e['id'] != resp.data['result'])

                    }
                }).catch(err => {
                    console.log(err);
                })
            },
            activeMod() {
                let th = this

                if (!th.is_registered && (th.user == 'not')) { document.getElementById('myBut').click() }
                else { th.send_dem() }
            },
            send_dem() {
                if (!this.r_subs.length) {
                    alert('Veuillez choisir au moins un produit pour envoyer votre demande.')
                    return;
                }
                let th = this
                th.sending = true
                if (!th.is_registered && (th.user == 'not')) document.getElementById('closeModUs').click()
                const form = new FormData()
                form.append('cat', th.cat)
                form.append('subs', JSON.stringify(th.r_subs))
                form.append('emer', th.emer)
                for (det of this.sub_det) {
                    if ('files' in det) {
                        for (let i = 0; i < det['files'].length; i++) {

                            form.append(`file:${det.id}:${i}`, det.files[i])
                        }
                    }
                }
                const ident = localStorage.getItem('ident')
                if (ident) form.append('ident', ident)
                if (th.bdg_h) form.append('bdg_h', th.bdg_h)
                form.append('sub_det', JSON.stringify(this.sub_det))
                form.append('state', th.state)
                if (th.user == 'not') {
                    th.checkNumber()
                    if (!th.is_what) {
                        th.checkNumber_w()
                    } else {
                        th.whatsapp = th.number
                    }

                    form.append('first_name', th.first_name)
                    form.append('last_name', th.last_name)
                    form.append('email', th.email)
                    form.append('country', th.country)
                    form.append('town', JSON.stringify(th.town))
                    form.append('number', th.number)
                    form.append('whatsapp', th.whatsapp)
                    form.append('quart', JSON.stringify(th.f_quart))
                }
                axios({
                    url: 'api/demand/',
                    method: "POST",
                    data: form,
                    headers: {
                        "accept": "application/json",
                        "Content-Type": "multipart/form-data",
                        "X-CSRFToken": "{{ csrf_token }}",
                    },
                }).then(resp => {
                    if (resp.data['done']) {
                        th.sending = false
                        th.show_thank = true
                        th.dem_p = 1
                        th.demands = []
                        th.r_subs = []
                        setTimeout(() => {
                            th.show_thank = false
                        }, 3500)
                    }
                    localStorage.setItem('customers_info', JSON.stringify({
                        first_name: th.first_name,
                        last_name: th.last_name,
                        email: th.email,
                        country: th.country,
                        town: th.town,
                        number: th.number,
                        whatsapp: th.whatsapp,
                        quart: th.f_quart
                    }))
                        th.get_demandes()
                }).catch(err => {
                    console.log(err);
                })
            },
            showPhone() {
                if (this.phoneInput) {
                    return true
                } else {
                    this.phoneInput = initphone()
                    this.showPhone()
                }
            },
            checkNumber() {
                this.can_show_valid = true
                this.num_err = []
                if (!window.phoneInput.isValidNumber()) {
                    this.can_show_valid = false
                    setTimeout(() => {
                        this.can_show_valid = true

                    }, 4000)
                } else {
                    let num = window.phoneInput.getNumber();
                    this.number = num
                }
            },
            checkNumber_w() {
                this.can_show_valid = true
                this.num_err = []
                if (!window.phoneInput_w.isValidNumber()) {
                    this.can_show_valid = false
                    setTimeout(() => {
                        this.can_show_valid = true
                    }, 4000)
                } else {
                    let num = window.phoneInput_w.getNumber();
                    this.whatsapp = num
                }
            },
        },
        compilerOptions: {
            delimiters: ["${", "}"]
        }
    }).mount('#app')
</script>
{% endblock %}